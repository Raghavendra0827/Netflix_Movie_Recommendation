import streamlit as st
import numpy as np
import pandas as pd
import seaborn as sns
import pickle
import matplotlib.pyplot as plt

Movies = pd.read_csv('Movies.csv')
Movies.drop(columns=["Unnamed: 0"], inplace=True)

with open('svd_model.pkl', 'rb') as file:
    loaded_svd_model = pickle.load(file)

background_image = 'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8bmV0ZmxpeHxlbnwwfHwwfHx8MA%3D%3D'
html_code = f"""
    <style>
        body {{
            background-image: url('{background_image}');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }}
        .stApp {{
            background: none;
        }}
    </style>
"""

def main():
    st.title("Netflix Movie Recommendation Engine")
    user_id_input = st.number_input("Enter User ID:", value=2378011)
    user_id = int(user_id_input)

    # Dropdown menu with the list of items
   usr = ['1:',
 '1488844',
 '822109',
 '885013',
 '30878',
 '823519',
 '893988',
 '124105',
 '1248029',
 '1842128',
 '2238063',
 '1503895',
 '2207774',
 '2590061',
 '2442',
 '543865',
 '1209119',
 '804919',
 '1086807',
 '1711859',
 '372233',
 '1080361',
 '1245640',
 '558634',
 '2165002',
 '1181550',
 '1227322',
 '427928',
 '814701',
 '808731',
 '662870',
 '337541',
 '786312',
 '1133214',
 '1537427',
 '1209954',
 '2381599',
 '525356',
 '1910569',
 '2263586',
 '2421815',
 '1009622',
 '1481961',
 '401047',
 '2179073',
 '1434636',
 '93986',
 '1308744',
 '2647871',
 '1905581',
 '2508819',
 '1578279',
 '1159695',
 '2588432',
 '2423091',
 '470232',
 '2148699',
 '1342007',
 '466135',
 '2472440',
 '1283744',
 '1927580',
 '716874',
 '4326',
 '1546549',
 '1493697',
 '880166',
 '535396',
 '494609',
 '1961619',
 '883478',
 '793564',
 '1567202',
 '573537',
 '1972040',
 '1838912',
 '411705',
 '2244518',
 '584542',
 '667730',
 '2488120',
 '1926776',
 '38052',
 '1196100',
 '314933',
 '1792741',
 '769643',
 '2477242',
 '1421006',
 '729846',
 '1719610',
 '1696031',
 '1817215',
 '406057',
 '636262',
 '1245406',
 '1834590',
 '593225',
 '1011918',
 '1665054',
 '2630337',
 '1155747',
 '2439493',
 '479924',
 '530789',
 '765860',
 '231001',
 '1493615',
 '1850615',
 '68959',
 '147386',
 '624035',
 '782308',
 '1116080',
 '421374',
 '1158759',
 '1025798',
 '1215397',
 '2475251',
 '321111',
 '2162676',
 '2635437',
 '2389367',
 '485622',
 '235553',
 '831869',
 '99400',
 '684876',
 '1871179',
 '1107678',
 '642036',
 '700890',
 '2289956',
 '2040859',
 '1524964',
 '121318',
 '317050',
 '2287003',
 '59052',
 '893742',
 '1346257',
 '55016',
 '30245',
 '743633',
 '1596531',
 '1125499',
 '706832',
 '2465337',
 '2291422',
 '1777406',
 '1904905',
 '2450433',
 '1348967',
 '638020',
 '2217779',
 '194280',
 '493009',
 '1567167',
 '850327',
 '520386',
 '320540',
 '1188228',
 '57961',
 '1113230',
 '1374216',
 '595778',
 '209573',
 '2354601',
 '2563596',
 '835265',
 '1819474',
 '1447104',
 '1100940',
 '143274',
 '2329565',
 '181592',
 '936396',
 '1125797',
 '2283366',
 '514495',
 '1772176',
 '1877347',
 '1287892',
 '255443',
 '890669',
 '1989766',
 '2315073',
 '14756',
 '907623',
 '991423',
 '1604238',
 '1027056',
 '2025883',
 '732936',
 '563962',
 '799442',
 '352635',
 '2537543',
 '1564395',
 '1655178',
 '573434',
 '1141189',
 '383247',
 '1763921',
 '1943970',
 '322009',
 '2333817',
 '2095681',
 '1149588',
 '2354740',
 '2421360',
 '496087',
 '2191781',
 '1694083',
 '818416',
 '701960',
 '2090477',
 '1664010',
 '2583822',
 '369646',
 '2234063',
 '259799',
 '1077982',
 '2631796',
 '1122383',
 '1508526',
 '1600207',
 '1283117',
 '1727869',
 '1522799',
 '1394012',
 '1558286',
 '1155602',
 '361066',
 '1743210',
 '1148389',
 '2268101',
 '519684',
 '767518',
 '122197',
 '2112162',
 '1073367',
 '400162',
 '1524343',
 '741245',
 '2563768',
 '1406595',
 '1137010',
 '60343',
 '225765',
 '2530404',
 '437881',
 '1935793',
 '134001',
 '2607300',
 '1008986',
 '94565',
 '828410',
 '1805202',
 '1922925',
 '1435717',
 '2277395',
 '2305014',
 '166041',
 '2413320',
 '87113',
 '722591',
 '2291306',
 '2010770',
 '255383',
 '1873429',
 '1647618',
 '608234',
 '42930',
 '1462072',
 '685565',
 '3321',
 '2554942',
 '1874547',
 '2269844',
 '34907',
 '1779903',
 '2576424',
 '230112',
 '508727',
 '1603525',
 '172264',
 '1182185',
 '2275470',
 '491531',
 '1346432',
 '1554712',
 '1450941',
 '1714116',
 '2016488',
 '1782762',
 '1343170',
 '2565752',
 '435841',
 '2242821',
 '638824',
 '2256485',
 '101597',
 '623036',
 '1559445',
 '1723381',
 '1824586',
 '2233105',
 '682963',
 '2529547',
 '504620',
 '1682104',
 '16272',
 '2491785',
 '978412',
 '2054145',
 '2444240',
 '547732',
 '811790',
 '31913',
 '437111',
 '640588',
 '2625019',
 '2605190',
 '915',
 '1430587',
 '2544219',
 '2603381',
 '305344',
 '2569099',
 '2430356',
 '885165',
 '2380806',
 '1512406',
 '1774623',
 '2226525',
 '2537076',
 '2060858',
 '498469',
 '68033',
 '1819146',
 '2088415',
 '473070',
 '1823641',
 '1839976',
 '14924',
 '1852606',
 '453694',
 '921487',
 '1022254',
 '2464081',
 '1228324',
 '1563530',
 '1181170',
 '1357013',
 '21722',
 '288420',
 '1739170',
 '2584676',
 '2013504',
 '1245176',
 '269524',
 '661344',
 '652324',
 '2239213',
 '863302',
 '758850',
 '1884755',
 '544833',
 '1562707',
 '810700',
 '837756',
 '155164',
 '493945',
 '1565175',
 '2005193',
 '1605780',
 '1294335',
 '608576',
 '659505',
 '1604707',
 '2630797',
 '402266',
 '752642',
 '1906145',
 '389872',
 '1462866',
 '1952116',
 '54774',
 '1776980',
 '1494196',
 '253794',
 '1569513',
 '596728',
 '1107588',
 '1133763',
 '1398076',
 '1178171',
 '984369',
 '2618594',
 '1653834',
 '2322840',
 '2207647',
 '1994111',
 '1824044',
 '2255037',
 '2056022',
 '1458179',
 '1508350',
 '1168571',
 '766489',
 '1424199',
 '2054180',
 '448902',
 '1547173',
 '1751103',
 '121073',
 '2609436',
 '1398626',
 '1311231',
 '2279000',
 '236921',
 '2566259',
 '758937',
 '2260684',
 '1190829',
 '136106',
 '344753',
 '568930',
 '206115',
 '2390644',
 '2078679',
 '1682651',
 '386915',
 '972136',
 '1806515',
 '11589',
 '2118461',
 '444411',
 '691108',
 '332401',
 '1278488',
 '358776',
 '387418',
 '872408',
 '646098',
 '396595',
 '1366860',
 '1046882',
 '470861',
 '1455257',
 '1274780',
 '379184',
 '1273630',
 '492291',
 '145873',
 '1388284',
 '712610',
 '1116065',
 '660499',
 '1918987',
 '1357894',
 '190418',
 '1060658',
 '1443203',
 '1772839',
 '2385774',
 '1059319',
 '831775',
 '881346',
 '1066317',
 '13651',
 '208920',
 '308753',
 '2564257',
 '565041',
 '1602153',
 '173930',
 '202811',
 '353369',
 '1201176',
 '2047577',
 '685113',
 '1686060',
 '151004',
 '2126192',
 '1981464',
 '1862581',
 '1255780',
 '1962300',
 '1515355',
 '1001779',
 '2093105',
 '1123959',
 '1876297',
 '1364481',
 '998236',
 '328415',
 '1347129',
 '1117062',
 '1033930',
 '45117',
 '1005769',
 '712609',
 '740495',
 '2497991',
 '1017324',
 '120491',
 '1645794',
 '1658790',
 '2451020',
 '1878798',
 '1790903',
 '1254683',
 '874943',
 '121456',
 '1140108',
 '515436',
 '272689',
 '1247177',
 '263240',
 '2539549',
 '2565654',
 '334701',
 '42921',
 '2011399',
 '433945',
 '2151149',
 '1415954',
 '1086360',
 '2419258',
 '2380848',
 '1550216',
 '596533',
 '287901',
 '188613',
 '1654508',
 '1313126',
 '51334',
 '2374451',
 '2031093',
 '548064',
 '946102',
 '1790158',
 '1403184',
 '1535440',
 '1426604',
 '1815755',
 '2:',
 '2059652',
 '1666394',
 '1759415',
 '1959936',
 '998862',
 '2625420',
 '573975',
 '392722',
 '1401650',
 '988104',
 '977632',
 '2557870',
 '1793899',
 '1340535',
 '1888322',
 '1283598',
 '1784150',
 '2271251',
 '65932',
 '1828884',
 '1878728',
 '1922778',
 '1176404',
 '2265116',
 '1078701',
 '1832577',
 '748922',
 '1013802',
 '1131325',
 '2244378',
 '494639',
 '1903158',
 '220427',
 '2225116',
 '1445632',
 '2592823',
 '1288603',
 '2556926',
 '1190070',
 '1312846',
 '2226229',
 '1563935',
 '69809',
 '1349753',
 '785768',
 '426476',
 '810636',
 '468713',
 '222290',
 '349407',
 '311232',
 '2596999',
 '1025601',
 '1743759',
 '2385553',
 '526466',
 '2648861',
 '1210631',
 '2314531',
 '618272',
 '2532807',
 '412535',
 '1315005',
 '1358911',
 '507603',
 '1507649',
 '845529',
 '1479907',
 '236271',
 '2422676',
 '1636093',
 '995594',
 '2431481',
 '1980668',
 '402321',
 '1344564',
 '1632603',
 '2567280',
 '1623166',
 '521932',
 '105086',
 '2072554',
 '2231529',
 '2103439',
 '261764',
 '193476',
 '1576540',
 '1783594',
 '503334',
 '183903',
 '2606799',
 '1236127',
 '2375962',
 '2212071',
 '1252841',
 '247898',
 '970975',
 '1581186',
 '1129620',
 '584750',
 '11409',
 '1875495',
 '1403217',
 '2147527',
 '2418486',
 '1476323',
 '2345723',
 '2640085',
 '1803154',
 '1251170',
 '527491',
 '391517',
 '828919',
 '196494',
 '715897',
 '268917',
 '41422',
 '2019055',
 '348960',
 '1167731',
 '2468831',
 '219925',
 '1025193',
 '630887',
 '1461435',
 '1838586',
 '1515430',
 '1807053',
 '1172326',
 '1785842',
 '803752',
 '1581265',
 '1824543',
 '1283204',
 '1272122',
 '3:',
 '1025579',
 '712664',
 '1331154',
 '2632461',
 '44937',
 '656399',
 '439011',
 '1436762',
 '1644750',
 '2031561',
 '616720',
 '2467008',
 '975874',
 '701730',
 '1614320',
 '115498',
 '931626',
 '699878',
 '1694958',
 '66414',
 '2519847',
 '948069',
 '67315',
 '704249',
 '454417',
 '1995318',
 '2158448',
 '574843',
 '714960',
 '620771',
 '253876',
 '1632700',
 '603277',
 '79160',
 '1859725',
 '283774',
 '1983667',
 '2267507',
 '1813349',
 '2424721',
 '1275804',
 '1204327',
 '2143489',
 '672980',
 '166100',
 '2537764',
 '1650301',
 '553931',
 '214166',
 '6689',
 '109089',
 '1854303',
 '525003',
 '2312349',
 '188416',
 '2213550',
 '24344',
 '2344483',
 '531155',
 '1959707',
 '2120279',
 '1977959',
 '21983',
 '2173816',
 '78931',
 '2145227',
 '2463079',
 '1286051',
 '958104',
 '489962',
 '2297863',
 '958382',
 '248932',
 '1756658',
 '2579794',
 '1628475',
 '206809',
 '1333',
 '445828',
 '2079559',
 '1007809',
 '1562675',
 '1477923',
 '44783',
 '52540',
 '2436327',
 '1830211',
 '1857979',
 '1198785',
 '870391',
 '2164676',
 '1281996',
 '1853885',
 '2646060',
 '709342',
 '1195585',
 '1319527',
 '1478381',
 '1658752',
 '41371',
 '1479793',
 '1406148',
 '2446687',
 '968796',
 '2266857',
 '1456369',
 '1078792',
 '104768',
 '372528',
 '2240742',
 '1401399',
 '402377',
 '51230',
 '2229289',
 '2554745',
 '1710932',
 '1355097',
 '1231910',
 '2599552',
 '1394444',
 '1094443',
 '77266',
 '153249',
 '2590630',
 '2596383',
 '2601294',
 '2623268',
 '1756597',
 '1673185',
 '2611525',
 '2013198',
 '1704175',
 '2186436',
 '2252223',
 '780282',
 '203667',
 '2338873',
 '479779',
 '1927897',
 '719833',
 '871489',
 '968765',
 '1057518',
 '257517',
 '2003554',
 '2203875',
 '2213289',
 '2630072',
 '1142291',
 '1733188',
 '1614895',
 '1947922',
 '1036823',
 '1197233',
 '1100037',
 '1130826',
 '620147',
 '1479047',
 '1221390',
 '2193643',
 '544496',
 '357507',
 '976059',
 '820624',
 '924839',
 '966255',
 '108052',
 '375319',
 '309333',
 '1599030',
 '2443370',
 '871580',
 '311641',
 '532382',
 '2378011',
 '946970',
 '175763',
 '619721',
 '1248452',
 '1863843',
 '1915354',
 '920625',
 '1100170',
 '1733406',
 '755319',
 '1743030',
 '309567',
 '2096587',
 '345869',
 '1544094',
 '1022903',
 '290951',
 '1737484',
 '183215',
 '2065639',
 '250836',
 '2126122',
 '1206452',
 '2068821',
 '1924939',
 '1940163',
 '1033433',
 '1213801',
 '1045221',
 '253037',
 '341954',
 '697945',
 '1115632',
 '2103655',
 '2495200',
 '714550',
 '979820',
 '514312',
 '2025577',
 '1589677',
 '425033',
 '2352327',
 '156078',
 '851855',
 '2441707',
 '1278394',
 '962955',
 '811218',
 '636475',
 '1087412',
 '410537',
 '1586499',
 '917063',
 '1023101',
 '2393306',
 '788774',
 '2586963',
 '2368791',
 '244266',
 '2622138',
 '793228',
 '1283965',
 '2135038',
 '722006',
 '1511683',
 '1939663',
 '1763372',
 '1834472',
 '209549',
 '515850',
 '1455472',
 '2301782',
 '770921',
 '297498',
 '386510',
 '2494367',
 '1607574',
 '1594095',
 '1124822',
 '544022',
 '1817216',
 '1931698',
 '569099',
 '1771085',
 '604949',
 '213541',
 '790920',
 '2554707',
 '376148',
 '1689439',
 '2485566',
 '2232958',
 '2267858',
 '1956967',
 '2494005',
 '323148',
 '2158065',
 '2370268',
 '2152838',
 '1407746',
 '1666581',
 '871548',
 '2385706',
 '1969676',
 '1927329',
 '1938559',
 '199769',
 '2576108',
 '162854',
 '215406',
 '2095263',
 '556045',
 '817851',
 '2491399',
 '1134816',
 '660454',
 '581199',
 '1545189',
 '1929487',
 '528384',
 '2646115',
 '727242',
 '247940',
 '369761',
 '1065126',
 '1101467',
 '393413',
 '478176',
 '1369550',
 '2428502',
 '282525',
 '2085230',
 '282522',
 '2246070',
 '532649',
 '1053903',
 '1521266',
 '2303969',
 '2580481',
 '2551806']
    selected_item = st.selectbox("Select an item:", [""] + usr)

    if st.button("Recommend Movies"):
        Recommend(user_id, Movies)


def Recommend(User_ID, Movies):
    try:
        Movies['Estimate_Score'] = Movies['Movie_Id'].apply(lambda x: loaded_svd_model.predict(User_ID, x).est)
        Movie = Movies.sort_values('Estimate_Score', ascending=False)
    except:
        st.warning("Invalid User ID")

    st.header("Top 10 Recommended Movies:")
    for idx, movie_name in enumerate(Movie['Name'][:10]):
        st.write(f"{idx + 1}. {movie_name}")

    fig, ax = plt.subplots(figsize=(10, 6))
    heatmap_data = pd.DataFrame({'Names': Movie['Name'][:10], 'Priority': [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]})
    heatmap_data['Priority'] = pd.to_numeric(heatmap_data['Priority'], errors='coerce').fillna(0)
    heatmap_data.set_index('Names', inplace=True)
    sns.heatmap(heatmap_data[['Priority']], annot=True, fmt="g", cmap="YlGnBu", cbar_kws={'label': 'Estimate Score'}, ax=ax)
    st.pyplot(fig)

if __name__ == "__main__":
    st.markdown(html_code, unsafe_allow_html=True)
    main()
